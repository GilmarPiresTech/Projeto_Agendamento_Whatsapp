<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Configuração de Horários de Trabalho</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .custom-bg {
            background-color: #65B037;
        }
        .text-title {
            color: #FFFFFF;
        }
        .nav-bar {
            background-color: #4C9F38;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 100%;
        }
        .nav-item {
            padding: 10px 20px;
            color: #FFFFFF;
            font-weight: bold;
            font-size: 1.20rem;
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background-color: #65B037;
            border-radius: 8px;
            transform: scale(1.05);
        }
        .btn-save {
            background-color: #4CAF50;
        }
        .btn-save:hover {
            background-color: #45A049;
        }
    </style>
</head>
<body class="custom-bg font-sans text-gray-900">
    <h1 class="text-4xl font-bold text-center text-title py-8">Configuração de Horários de Trabalho</h1>
    <form action="{{ url_for('config_horarios') }}" method="post" class="max-w-4xl mx-auto bg-white p-6 rounded-md shadow-md mt-8">
        <table class="min-w-full">
            <thead class="bg-green-600 text-white">
                <tr>
                    <th class="px-4 py-2">Dia da Semana</th>
                    <th class="px-4 py-2">Início</th>
                    <th class="px-4 py-2">Início Almoço</th>
                    <th class="px-4 py-2">Fim Almoço</th>
                    <th class="px-4 py-2">Fim</th>
                    <th class="px-4 py-2">Folga</th>
                    <th class="px-4 py-2">Não há Almoço</th>
                </tr>
            </thead>
            <tbody>
                {% for dia in ['Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado', 'Domingo'] %}
                <tr class="border-b hover:bg-gray-100">
                    <td class="px-4 py-2">
                        {{ dia }}
                        <input type="hidden" name="dia" value="{{ dia }}">
                    </td>
                    <td class="px-4 py-2">
                        <input type="time" name="inicio_{{ loop.index0 }}" class="form-input rounded border-gray-300" value="{{ config.get(dia, {}).get('Início', '') }}">
                    </td>
                    <td class="px-4 py-2">
                        <input type="time" name="inicio_almoco_{{ loop.index0 }}" class="form-input rounded border-gray-300" value="{{ config.get(dia, {}).get('Início_Almoço', '') }}" id="inicio_almoco_{{ loop.index0 }}">
                    </td>
                    <td class="px-4 py-2">
                        <input type="time" name="fim_almoco_{{ loop.index0 }}" class="form-input rounded border-gray-300" value="{{ config.get(dia, {}).get('Fim_Almoço', '') }}" id="fim_almoco_{{ loop.index0 }}">
                    </td>
                    <td class="px-4 py-2">
                        <input type="time" name="fim_{{ loop.index0 }}" class="form-input rounded border-gray-300" value="{{ config.get(dia, {}).get('Fim', '') }}">
                    </td>
                    <td class="px-4 py-2">
                        <input type="checkbox" name="folga_{{ loop.index0 }}" class="form-checkbox text-red-600" value="{{ dia }}" {% if config.get(dia, {}).get('Status') == 'Folga' %}checked{% endif %}>
                    </td>
                    <td class="px-4 py-2">
                        <input type="checkbox" name="nao_ha_almoco_{{ loop.index0 }}" class="form-checkbox" value="true" onchange="toggleAlmoco({{ loop.index0 }})" {% if config.get(dia, {}).get('Nao_Ha_Almoco') == 'Sim' %}checked{% endif %}>
                    </td>                    
                </tr>
                {% endfor %}
            </tbody>                      
        </table>
        <button type="submit" class="w-full py-2 px-4 btn-save text-white font-bold rounded hover:bg-green-700 mt-4">Salvar Configurações</button>
    </form>

    <nav class="nav-bar mt-8">
        <ul class="flex justify-center space-x-4">
            <li><a href="{{ url_for('index') }}" class="nav-item">Agendar Consulta</a></li>
            <li><a href="{{ url_for('calendario') }}" class="nav-item">Calendário</a></li>
            <li><a href="{{ url_for('tipos_consulta') }}" class="nav-item">Tipos de Consulta</a></li>
            <li><a href="{{ url_for('marcar_folga') }}" class="nav-item">Marcar Folga</a></li>
        </ul>
    </nav>

    <script>
        // Função para habilitar/desabilitar os campos de almoço
        function toggleAlmoco(index) {
            const inicioAlmoco = document.getElementById(`inicio_almoco_${index}`);
            const fimAlmoco = document.getElementById(`fim_almoco_${index}`);
            const checkbox = document.getElementsByName(`nao_ha_almoco_${index}`)[0];

            if (checkbox.checked) {
                inicioAlmoco.disabled = true;
                fimAlmoco.disabled = true;
                inicioAlmoco.value = '';  // Garante que o valor enviado será vazio
                fimAlmoco.value = '';     // Garante que o valor enviado será vazio
            } else {
                inicioAlmoco.disabled = false;
                fimAlmoco.disabled = false;
            }
        }
    </script>
    

    <script>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                Swal.fire({
                    icon: '{{ 'success' if category == 'success' else 'error' }}',
                    title: '{{ message }}',
                    showConfirmButton: false,
                    timer: 3000
                });
            {% endfor %}
        {% endif %}
        {% endwith %}
    </script>

</body>
</html>
